# 前端 UI/UX 重構計畫 (20250407)

## 目標

-   解決介面擁擠問題，降低視覺負擔。
-   優化控制項，突出核心聊天功能。
-   實現頭部/身體分割視圖。
-   引入浮動聊天視窗，提升互動彈性。
-   採用 Tailwind CSS 實現現代化、簡潔的 UI 風格。

## TODO 列表

### Phase 1: 環境設定與基礎佈局

1.  **[ ] 設定 Tailwind CSS 環境**
    *   [ ] 安裝 `tailwindcss`, `postcss`, `autoprefixer` 開發依賴。
    *   [ ] 產生 `tailwind.config.js` 和 `postcss.config.js` 設定檔。
    *   [ ] 配置 `tailwind.config.js` 的 `content` 路徑，掃描 `src/` 下的元件檔案。
    *   [ ] (可選) 自訂 `tailwind.config.js` 的 `theme` (顏色、字體、間距等)。
    *   [ ] 在主要的 CSS 檔案 (如 `src/index.css` 或 `src/App.css`) 中引入 `@tailwind base;`, `@tailwind components;`, `@tailwind utilities;`。
    *   [ ] 確保主 CSS 檔案被應用程式入口 (`main.tsx`) 引入。
    *   [ ] 驗證 Tailwind 是否生效 (例如，在某個元件中添加一個 Tailwind class 如 `bg-red-500` 看看效果)。

2.  **[ ] 實現分割畫面基礎 (使用 R3F `<View>`)**
    *   [ ] 在 `App.tsx` 或 `AppUI.tsx` 中，使用 Tailwind CSS (e.g., `flex` 或 `grid`) 創建兩個主要的 `div` 容器，用於左右或上下分割畫面。
    *   [ ] 在 R3F 的 `<Canvas>` 元件中，載入必要的 3D 場景元素 (燈光、模型等)。
    *   [ ] 為每個 `div` 容器創建一個 `@react-three/drei` 的 `<View>` 元件。
        *   將每個 `<View>` 的 `track` 屬性指向對應的 `div` 的 `ref`。
    *   [ ] 在每個 `<View>` 內部定義獨立的 `<PerspectiveCamera>`。
    *   [ ] 設定每個攝影機的位置 (`position`) 和焦點 (`lookAt` 或使用控制器)，使其分別對準頭部和身體模型。
    *   [ ] (初步) 確保兩個 `<View>` 能成功渲染同一個場景的不同視角。

### Phase 2: 核心元件開發

3.  **[ ] 開發 `FloatingChatWindow.tsx` 元件**
    *   [ ] 創建新元件 `src/components/FloatingChatWindow.tsx`。
    *   [ ] 基本結構：包含標題欄、聊天訊息顯示區 (`div`，可滾動)、文字輸入框 (`textarea` 或 `input`)。
    *   [ ] 使用 Tailwind CSS 設計元件樣式 (背景、邊框、圓角、內外邊距、字體等)。考慮加入輕微透明度。
    *   [ ] **整合錄音按鈕：**
        *   將原 `AudioControls` 的錄音按鈕邏輯 (圖示、點擊事件) 整合到此元件，放置於輸入框旁邊或上方。
        *   連接到 `AudioSlice` 或相關 Hook 的 `startRecording`/`stopRecording` 狀態和方法。
    *   [ ] **實現拖動功能：**
        *   安裝 `react-draggable` 函式庫。
        *   使用 `<Draggable>` 包裹 `FloatingChatWindow` 元件，設定 `handle` (指定可拖動的區域，如標題欄)。
    *   [ ] **實現縮放功能：**
        *   安裝 `react-resizable` 函式庫 (或使用 CSS `resize`，但後者可控性較差)。
        *   使用 `<Resizable>` 包裹 `FloatingChatWindow` 元件內容，設定 `handles` (可縮放的邊角)。
    *   [ ] **狀態管理 (初步):**
        *   使用 `useState` 管理元件內部的顯示/隱藏狀態 (稍後會連接到 Zustand)。
        *   (可選) 使用 `useState` 管理位置和大小，或為後續連接 Zustand 預留介面。
    *   [ ] **聊天記錄顯示：** 連接到 `ChatSlice` 讀取 `messages` 並渲染。
    *   [ ] **訊息發送：** 連接到 `ChatSlice` 或 `ChatService` 的發送訊息邏輯。

4.  **[ ] 開發 `SettingsPanel.tsx` 元件**
    *   [ ] 創建新元件 `src/components/SettingsPanel.tsx`。
    *   [ ] 包含按鈕：「開啟調試」、「模型分析工具」、「切換模型」。
    *   [ ] 使用 Tailwind CSS 設計元件樣式 (例如，一個從角落滑出的小面板樣式)。
    *   [ ] 實現顯示/隱藏邏輯 (可由外部 props 控制，稍後連接到 Zustand)。
    *   [ ] 添加 CSS Transitions 或使用 Framer Motion 實現滑入/滑出或展開/收合動畫。
    *   [ ] 創建一個觸發按鈕 (例如，在 `AppUI.tsx` 中的角落放置一個 ⚙️ 設定圖示)，用於控制 `SettingsPanel` 的顯示/隱藏。

### Phase 3: 狀態管理整合與邏輯完善

5.  **[ ] 整合 Zustand 狀態**
    *   [ ] **`AppSlice.ts`:**
        *   [ ] 添加 `isSettingsPanelOpen: boolean` 狀態及其切換 Action。
        *   [ ] 將 `SettingsPanel` 的顯示/隱藏邏輯連接到此狀態。
        *   [ ] 將設定圖示按鈕的點擊事件連接到切換 Action。
    *   [ ] **`ChatSlice.ts`:**
        *   [ ] 添加 `isChatWindowOpen: boolean` 狀態及其切換 Action。
        *   [ ] 將 `FloatingChatWindow` 的顯示/隱藏邏輯連接到此狀態。
        *   [ ] 修改原有的「聊天」按鈕 (可能簡化為圖示按鈕)，使其點擊時觸發此切換 Action。
        *   [ ] (可選，若需持久化) 添加 `chatWindowPosition` 和 `chatWindowSize` 狀態，並在 `react-draggable` 的 `onStop` 和 `react-resizable` 的 `onResizeStop` 事件中更新 Store。
    *   [ ] **`ModelSlice.ts` / `AudioSlice.ts`:** 確保與 `FloatingChatWindow` 和 `SettingsPanel` 中相關功能的連接正確 (模型切換、錄音狀態等)。

6.  **[ ] 完善模型動畫邏輯**
    *   [ ] 確保後端傳來的數據 (Morph Targets, 骨骼動畫) 能正確更新到 R3F 場景中的模型狀態。
    *   [ ] 驗證分割畫面中的兩個 `<View>` 都能根據共享的模型狀態，正確顯示各自視角的表情和動作。

### Phase 4: 樣式細化與逐步重構

7.  **[ ] 細化樣式與動畫**
    *   [ ] 回顧所有新元件 (`FloatingChatWindow`, `SettingsPanel`) 和佈局，使用 Tailwind 微調視覺細節 (顏色、間距、陰影、圓角等)，確保符合極簡、現代風格。
    *   [ ] 優化所有過渡動畫 (面板滑出、視窗彈出)，確保流暢自然。
    *   [ ] 測試不同螢幕尺寸下的響應式表現，使用 Tailwind 的響應式修飾符 (e.g., `md:`, `lg:`) 進行調整。

8.  **[ ] 逐步重構現有元件**
    *   [ ] **識別:** 找出專案中未使用 Tailwind 的舊元件 (檢查 `src/components/` 下的其他檔案)。
    *   [ ] **規劃:** 決定重構的優先順序 (可以從與新介面互動較多的元件開始)。
    *   [ ] **執行:** 逐個元件進行重構：
        *   移除舊的 CSS Modules 引用或 CSS-in-JS 樣式。
        *   使用 Tailwind utility classes 重新實現元件樣式。
        *   注意樣式衝突，必要時調整。
    *   [ ] **測試:** 確保重構後的元件外觀和功能與之前一致。

### Phase 5: 測試與部署

9.  **[ ] 全面測試**
    *   [ ] 功能測試：所有按鈕、互動（拖動、縮放、聊天、錄音、模型切換等）是否正常工作。
    *   [ ] UI/UX 測試：佈局、樣式、動畫是否符合設計預期，操作是否流暢直觀。
    *   [ ] 跨瀏覽器測試：在主要瀏覽器 (Chrome, Firefox, Safari, Edge) 上檢查兼容性。
    *   [ ] 響應式測試：在不同設備尺寸或瀏覽器寬度下檢查佈局和可用性。
    *   [ ] 效能測試：檢查 R3F 渲染效能，特別是分割畫面和動畫是否流暢。

10. **[ ] 部署**
    *   [ ] 確保建置流程包含 Tailwind CSS 的 PurgeCSS 步驟，以優化最終 CSS 大小。
    *   [ ] 將更新後的前端應用部署到目標環境。 