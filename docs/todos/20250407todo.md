# 前端 UI/UX 重構計畫 (20250407 - 精煉版 v2)

## 目標

-   解決介面擁擠問題，降低視覺負擔。
-   優化控制項，突出核心聊天功能。
-   引入浮動、可調整大小的聊天視窗，提升互動彈性。
-   採用 Tailwind CSS 實現現代化、簡潔且一致的 UI 風格。

## TODO 列表

### Phase 1: 環境設定與基礎重構

1.  **[x] 設定 Tailwind CSS 環境 (使用 v4 + Vite 插件)**
    *   [x] **安裝相關依賴：** `tailwindcss`, `postcss`, `autoprefixer`, `@tailwindcss/vite`。
    *   ~~[ ] **產生設定檔：** 生成 `tailwind.config.js` 和 `postcss.config.js`。~~ (v4 不需要 `init`)
    *   [ ] **配置內容掃描路徑 (`tailwind.config.js`)：** (如果需要手動創建此文件來自訂) 確保設定檔能掃描到所有使用 Tailwind class 的專案檔案，防止生產環境樣式丟失。
    *   [ ] **(可選) 自訂主題 (`tailwind.config.js`)：** (如果需要手動創建此文件來自訂) 初期建議先用預設主題，待核心功能穩定後再統一調整品牌風格。
    *   [x] **配置 Vite 插件：** 在 `vite.config.ts` 中加入 `@tailwindcss/vite` 插件。
    *   [x] **引入 Tailwind 指令至主 CSS：** 在 CSS 進入點 (如 `src/index.css`) 使用 `@import "tailwindcss";`。
    *   [x] **確認 CSS 引入：** 主 CSS 檔案已被應用程式入口載入。
    *   [x] **驗證生效：** 確認 Tailwind 樣式已成功應用。

### Phase 2: 核心元件開發 (使用 Tailwind)

2.  **(原 3.) [進行中] 開發 `FloatingChatWindow.tsx` 元件**
    *   [x] **創建新元件檔案。**
    *   [x] **基本結構與樣式:** (使用 Tailwind 完成基礎佈局、顏色、邊框、陰影等)
    *   [x] **整合錄音功能：** (麥克風按鈕已連接 `start/stopRecording`，功能經驗證 OK)
    *   [x] **實現拖動/縮放:** (已使用 `react-draggable` 和 `react-resizable` 實現基礎拖放和縮放功能)
        *   [x] **安裝依賴：** `react-draggable`, `react-resizable`, `@types/react-resizable`。
        *   [x] **實現拖動：** 已包裹元件並設定標題欄為把手。
        *   [x] **實現縮放：** 已包裹元件並設定最小/最大約束。
        *   [ ] **效能提醒:** (尚未處理，目前拖放結束時更新本地 state)
        *   [ ] **可訪問性考量:** (尚未處理)
    *   [ ] **狀態管理策略 (本地 vs. 全局):**
        *   [x] **顯示/隱藏狀態：** 由全局 Zustand (`ChatSlice.isChatWindowVisible`) 控制。
        *   [ ] **位置/大小狀態：**
            *   [x] **方案 A (目前):** 使用元件內部狀態 (`useState`) 管理，不跨會話保留。
            *   [ ] **方案 B (持久化):** (待定) 尚未決定是否需要全局持久化。
    *   [x] **連接聊天邏輯：** (已對接 `messages`, `userInput`, `isProcessing`, `sendMessage` 等狀態和函數，聊天記錄、輸入、發送、清空功能已連接)。
    *   **未來功能規劃 (Note):**
        *   [ ] **支援 Markdown 渲染:** 聊天訊息應能正確顯示 Markdown 格式。
        *   [ ] **支援圖片顯示:** 能夠在聊天記錄中顯示圖片 (來自後端或用戶)。
        *   [ ] **支援圖片上傳:** 提供用戶上傳圖片的功能。
        *   [ ] **作為主要互動介面:** 考慮未來擴展為虛擬主播的主要互動視窗，支援推播消息、用戶留言互動等場景。

3.  **(原 4.) [x] 開發 `SettingsPanel.tsx` 元件**
    *   [x] **創建新元件檔案。**
    *   [x] **包含控制項：** (已從舊 `ControlPanel` 遷移模型變換、動畫、預設表情、Morph Target 控制項)。
    *   [x] **樣式與動畫:** (已使用 Tailwind CSS 重構樣式，添加了基礎的顯隱透明度過渡)。
    *   [x] **設計觸發按鈕:** (已在 `AppUI` 中添加齒輪圖示觸發按鈕)。
    *   [x] **實現拖動:** (已使用 `react-draggable` 實現面板拖動)。
    *   [ ] **可訪問性:** (尚未處理)。

### Phase 3: 狀態管理整合與邏輯完善

4.  **(原 5.) [進行中] 整合 Zustand 狀態**
    *   [ ] **優化狀態讀取:** 在所有使用 `useStore` 的地方，盡可能使用 **Selector 函數** 精確訂閱所需狀態片段，減少不必要的元件重渲染。(部分完成於 `Model.tsx`)
    *   [x] **實現狀態與 Actions:** (已在 `ChatSlice` 和 `AppSlice` 中添加管理面板顯示/隱藏的狀態與 Actions)。
    *   [x] **連接觸發器與 Actions:** (已將觸發按鈕連接到對應 Actions)。
    *   [ ] **檢查跨 Slice 影響:** 審視 Actions 是否會間接修改其他 Slice 的狀態，確保數據流清晰可控。
    *   [ ] **配置持久化 (若選擇):** 如果選擇持久化聊天視窗狀態，需設定 Zustand 的 `persist` 中間件。

5.  **[ ] 完善模型動畫邏輯**
    *   [ ] **確認數據流:** 完整追蹤從後端事件到服務層，再到 Zustand Store (`ModelSlice`)，最終反映到 R3F 場景中模型狀態的更新路徑。
    *   [ ] **驗證動畫更新:** 確保當共享的模型狀態 (如 Morph Targets 或骨骼數據) 更新時，3D 模型能正確渲染出預期的動畫效果。

### Phase 4: 樣式細化與逐步重構 (使用 Tailwind)

6.  **(原 7.) [ ] 細化樣式與動畫**
    *   [ ] **一致性檢查:** 確保動畫時長、緩動曲線等在應用中保持一致。
    *   [ ] **響應式設計:** 使用 Tailwind 的響應式修飾符確保介面在不同螢幕尺寸下表現良好。**建議：** 設計時優先考慮小螢幕佈局。
    *   [ ] **視覺打磨:** 微調顏色、間距、透明度、陰影等視覺元素，達成目標風格。

7.  **(原 8.) [進行中] 逐步重構現有元件 (使用 Tailwind)**
    *   [x] **制定策略:** (已完成新面板開發，移除舊面板切換邏輯)。
    *   [x] **移除舊元件/邏輯:** 
        *   [x] 移除 `App.tsx` 中的 `activeTab` / `switchTab`。
        *   [x] 移除 `AppUI.tsx` 中的條件渲染邏輯。
        *   [x] 刪除 `ControlPanel.tsx`, `ChatInterface.tsx`, `AudioControls.tsx`。
    *   [x] **重構 `AppUI` 按鈕樣式:** (觸發按鈕和調試按鈕已改用 Tailwind)。
    *   [ ] **處理樣式衝突:** (下一步：檢查並移除 `App.css` 中不再需要的樣式)。
    *   [ ] **合理使用 `@apply`:** (暫無需求)。

### Phase 5: 測試與部署

8.  **[ ] 全面測試**
    *   [ ] **互動場景測試：** 測試單獨及組合使用聊天視窗、設定面板的場景，包括拖動、縮放、重疊等情況。
    *   [ ] **邊界條件測試：** 例如將聊天視窗拖動到螢幕邊緣。
    *   [ ] **效能監控：** 使用瀏覽器工具檢查渲染效能，特別關注動畫和 3D 渲染同時進行時的流暢度。
    *   [ ] **跨瀏覽器與響應式測試。**

9.  **[ ] 部署**
    *   [ ] **構建確認:** 檢查生產構建過程，確保 Tailwind 的 PurgeCSS 功能正常運作，有效減小最終 CSS 體積。
    *   [ ] **最終線上驗證:** 在部署後的實際環境中，再次快速檢查核心功能和樣式表現。 