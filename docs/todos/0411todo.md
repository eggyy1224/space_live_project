# 2024-04-11 TODO

## 效能調校 - 提升回覆速度

### 後端優化

- [ ] 分析主要延遲來源：LLM 推理 (DialogueGraph 中的 call_llm_node 和 analyze_keyframes_node) 與 TTS 語音合成。
- [ ] 研究合併 DialogueGraph 中的兩次 LLM 呼叫，評估使用 Function Calling 或單次 JSON 輸出的可行性與效能。
- [ ] 評估並優化 TTS 服務 (text_to_speech.py)：研究更快的模型/設定，或改為非同步生成 (先回文字，後推語音)。
- [ ] 分析 MemorySystem (memory_system.py) 中記憶檢索 (特別是 ChromaDB 查詢) 的效能。
- [ ] 檢視 websocket.py 中的非同步流程，確保 AI、TTS、檔案儲存等操作盡可能併發執行，減少阻塞。
- [ ] 監控並評估 DialogueGraph 中外部工具 (維基百科、新聞 API 等) 呼叫的延遲影響。
- [ ] 

### 前端優化

- [ ] 

### 效能測試與監控

- [ ] 研究並導入合適的回覆速度測試工具 (例如日誌分析或專門工具)。
- [x] **建立基準測量**: 
    - [x] 在前端 (如 ChatService.ts) 實作使用者端到端延遲測量：從發送訊息到接收到第一個 `chat-message` 回覆的時間。
    - [x] 在後端 (websocket.py) 為 `chat-message` 處理流程添加詳細計時日誌：記錄接收請求、AI 呼叫起訖、TTS 呼叫起訖、音檔儲存(若有)、發送回覆等關鍵時間點。
- [ ] (進階) 在後端關鍵元件 (DialogueGraph 節點、MemorySystem 查詢、TTS API 呼叫) 內部添加更細粒度的耗時監控日誌。
- [ ] 